<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins自动化部署Vue项目前端及后端 | Hello VuePress2</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Hello, my friend!">
    <link rel="preload" href="/assets/css/0.styles.7ff0489b.css" as="style"><link rel="preload" href="/assets/js/app.0a9f859e.js" as="script"><link rel="preload" href="/assets/js/2.0a1de700.js" as="script"><link rel="preload" href="/assets/js/10.0b2efc69.js" as="script"><link rel="prefetch" href="/assets/js/3.74f36777.js"><link rel="prefetch" href="/assets/js/4.60dd998b.js"><link rel="prefetch" href="/assets/js/5.fb5d71e9.js"><link rel="prefetch" href="/assets/js/6.83b03a85.js"><link rel="prefetch" href="/assets/js/7.159f4c1d.js"><link rel="prefetch" href="/assets/js/8.b2767979.js"><link rel="prefetch" href="/assets/js/9.b23e8a71.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7ff0489b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello VuePress2</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  Tools
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  Tools
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tools/jenkins/jenkins-usage.html" class="sidebar-link">Jenkins基本使用</a></li><li><a href="/tools/jenkins/jenkins-docker-build-image.html" class="sidebar-link">Jenkins自动化部署docker镜像全过程</a></li><li><a href="/tools/jenkins/jenkins-gitlab-auto-devops.html" class="sidebar-link">Jenkins 配合Gitlab自动化构建项目</a></li><li><a href="/tools/jenkins/jenkins-vue-project.html" aria-current="page" class="active sidebar-link">Jenkins自动化部署Vue项目前端及后端</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h5 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h5> <p>操作系统 ubuntu 18</p> <ul><li>java安装</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> add-apt-repository ppa:openjdk-r/ppa
<span class="token comment"># 需要回车一下</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token builtin class-name">echo</span> y<span class="token operator">|</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-8-jdk

</code></pre></div> <ul><li>Jenkins 安装（这里安装的是服务版本的，可以选择安装docker版本，但是docker版本使用pipline时，用shell语言传输项目包会遇到很多权限等问题）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> -q -O - https://pkg.jenkins.io/debian/jenkins.io.key <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> <span class="token function">sh</span> -c <span class="token string">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token builtin class-name">echo</span> y<span class="token operator">|</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> jenkins
</code></pre></div><ul><li>安装完毕，相关启动命令，及目录：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">service</span> jenkins start<span class="token operator">|</span>stop<span class="token operator">|</span>restart

/var/lib/jenkins <span class="token comment"># jenkins 内容目录 workspace</span>
/var/lib/jenkins/.m2 <span class="token comment"># maven包放置目录</span>

/etc/default/jenkins <span class="token comment"># jenkins 配置文件 修改端口</span>

/usr/share/jenkins <span class="token comment"># jenkins war包放置目录</span>
</code></pre></div><ul><li><p>修改jenkins启动端口</p> <ol><li>修改/etc/init.d/jenkins jenkins开机启动脚本，修改do_start函数的check_tcp_port命令，端口号从8080换成8082</li> <li>修改/etc/default/jenkins 文件，修改：HTTP_PORT=8082</li></ol></li> <li><p>设置jenkins</p> <ol><li>此时打开对应端口网站：ip：8082，初始化时要求输入密码，密码为：/var/lib/jenkins/secrets/initialAdminPassword</li> <li>使用推荐配置，等待安装插件完毕</li> <li>设置用户，进入首页，tips:如果首页进入空白，则输入网址跳转到：ip:8082/pluginManager/advanced,修改：升级站点内容，的https-&gt;http,然后重启jenkins即可</li></ol></li> <li><p>插件安装，本文安装了 blue ocean, nodejs, publish over ssh 三个插件，如果要部署maven项目可以安装maven插件</p> <ol><li>blue ocean：可视化构建流程</li> <li>nodejs： 编译nodejs 项目</li> <li>publish over ssh： 编译完成后，传输到目标服务器</li></ol></li> <li><p>github配置</p> <ol><li><p>github setting-&gt;developer settings-&gt;personal access tokens,新建一个access token</p></li> <li><p>jenkins 系统管理，添加github服务器</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image7ff5ffe40ec7192a.png" alt="image7ff5ffe40ec7192a.png"></p> <p>密钥添加类型为 secret key，secret为上一步骤的access token</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image81f44369e7a63f9a.png" alt="image81f44369e7a63f9a.png"></p></li> <li><p>设置github hook,找到对应的项目，setting-&gt;webhoosks-&gt;add webhook,之后接可以在每次提交代码后，github通知jenkins自动拉取代码，并自动构建</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/imagee67a2b274f6055f2.png" alt="imagee67a2b274f6055f2.png"></p></li></ol></li></ul> <h5 id="开始使用"><a href="#开始使用" class="header-anchor">#</a> 开始使用</h5> <ul><li><p>新建任任务，构建一个自由风格的软件项目</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image14d3545f64cd9572.png" alt="image14d3545f64cd9572.png"></p></li> <li><p>进入页面，源码管理，选git ，输入仓库地址，并添加密钥，密钥类型选择username and password即可</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image1eadbd538c50d3ae.png" alt="image1eadbd538c50d3ae.png"></p></li> <li><p>配置构建触发，和构建环境。这里构建的是vue项目，所以选择了node环境（需要安装nodejs插件）。</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image106ce49d5c9702c8.png" alt="image106ce49d5c9702c8.png"></p></li> <li><p>构建步骤，选择执行shell 及send file or excute commands over ssh。第一步为通过插件构建项目，并打包。第二步为传输到目标服务器，ssh server可以通过系统管理中添加ssh server实现。这边时传输到windows 服务器，windows服务器开启sftp传输需要依赖第三方软件，本文用的是powershell server 2016，<a href="https://blog.csdn.net/achenyuan/article/details/81181347" target="_blank" rel="noopener noreferrer">具体使用方法参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/imageaa96d92508b6a834.png" alt="imageaa96d92508b6a834.png"></p></li></ul> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image5ba97e4a59dbf7cf.png" alt="image5ba97e4a59dbf7cf.png"></p> <ul><li><p>保存即可，此时如果本地提交代码，jenkins就可以自动拉取到代码，并自动打包传输到目标服务器。</p></li> <li><p>Pipeline使用，pipeline为自定义脚本控制部署流程，<a href="https://jenkins.io/zh/doc/" target="_blank" rel="noopener noreferrer">具体参考官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，需要在项目根目录下新建Jenkinsfile文件，示例如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>pipeline <span class="token punctuation">{</span>
    agent any
    stages <span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                steps <span class="token punctuation">{</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">'test'</span>
                    <span class="token function">sh</span> <span class="token string">'mvn -version'</span>
                <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         stage<span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 steps <span class="token punctuation">{</span>
                    <span class="token function">sh</span> <span class="token string">'mvn -B -DskipTests clean package'</span>
                 <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         stage<span class="token punctuation">(</span><span class="token string">'deliver'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      steps <span class="token punctuation">{</span>
                         <span class="token function">sh</span> <span class="token string">'./jenkins/test.sh'</span>
                            <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以自定义配置步骤，并调用脚本。</p> <p>jenkins配置示例：</p> <p><img src="http://blog.zhuangzexin.top:8082/images/2019/09/18/image404a5bc7631b92ae.png" alt="image404a5bc7631b92ae.png"></p> <p>可以通过流水线语法，来生成pipeline代码。</p></li></ul> <h5 id="附："><a href="#附：" class="header-anchor">#</a> 附：</h5> <ul><li><p>Windows 下操作脚本</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>::从sftproot里拷贝传输的压缩包 至temp文件夹（覆盖）
<span class="token function">copy</span> C:\<span class="token string">&quot;Program Files&quot;</span>\nsoftware\<span class="token string">&quot;PowerShell Server 2016&quot;</span>\sftproot\front<span class="token punctuation">.</span>zip D:\edu\deploy_backup\temp <span class="token operator">/</span>y
::将test环境压缩至备份文件夹
7z a  D:\edu\deploy_backup\zhxy<span class="token operator">%</span>Date:~0<span class="token punctuation">,</span>4%<span class="token operator">%</span>Date:~5<span class="token punctuation">,</span>2%<span class="token operator">%</span>Date:~8<span class="token punctuation">,</span>2%<span class="token operator">%</span>Time:~0<span class="token punctuation">,</span>2%<span class="token operator">%</span>Time:~3<span class="token punctuation">,</span>2%<span class="token operator">%</span>Time:~6<span class="token punctuation">,</span>2<span class="token operator">%</span><span class="token punctuation">.</span>zip D:\edu\zhxy_front_test\<span class="token operator">*</span><span class="token operator">*</span>
:: 删除test环境文件夹下内容
<span class="token function">rmdir</span> <span class="token operator">/</span>s<span class="token operator">/</span>q D:\edu\zhxy_front_test\static
<span class="token function">del</span> D:\edu\zhxy_front_test\static\index<span class="token punctuation">.</span>html

::解压temp文件，解压后有dist目录
7z x D:\edu\deploy_backup\temp\front<span class="token punctuation">.</span>zip <span class="token operator">-</span>oD:\edu\deploy_backup\temp

:: 拷贝dist文件夹下所有内容到测试环境
xcopy D:\edu\deploy_backup\temp\dist D:\edu\zhxy_front_test <span class="token operator">/</span>e <span class="token operator">/</span>y

:: 删除dist文件夹
<span class="token function">rmdir</span> <span class="token operator">/</span>s<span class="token operator">/</span>q D:\edu\deploy_backup\temp\dist
:: 删除传输过来的打包文件
<span class="token function">del</span>  C:\<span class="token string">&quot;Program Files&quot;</span>\nsoftware\<span class="token string">&quot;PowerShell Server 2016&quot;</span>\sftproot\front<span class="token punctuation">.</span>zip
</code></pre></div></li> <li><p>Linux shell 脚本</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token comment"># 部署到docker</span>
<span class="token assign-left variable">PROJECT</span><span class="token operator">=</span>generator
<span class="token assign-left variable">WAR</span><span class="token operator">=</span><span class="token variable">$WORKSPACE</span>/target/<span class="token variable">$PROJECT</span>-0.0.1-SNAPSHOT.war

<span class="token builtin class-name">echo</span> <span class="token string">&quot;待发布的 war 包：filepath=<span class="token variable">$WAR</span>&quot;</span>


<span class="token function">rm</span> -rf /home/docker/tomcat/webapps/<span class="token variable">$PROJECT</span>


<span class="token function">unzip</span> <span class="token variable">$WAR</span> -d /home/docker/tomcat/webapps/<span class="token variable">$PROJECT</span>

docker container restart tomcattest
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token comment"># 远程部署,需要配置ssh免密登录</span>
<span class="token comment"># author: zhuang1994@foxmail.com</span>
<span class="token comment"># description: 自动部署war包到指定的内网docker服务器</span>
<span class="token comment"># 1. mvn编译打包(jenkins完成)</span>
<span class="token comment"># 2. scp到目标内网服务器, 并解压到指定目录</span>
<span class="token comment"># 3. 重启docker tomcat容器</span>


<span class="token comment"># 1</span>
<span class="token assign-left variable">PROJECT</span><span class="token operator">=</span>generator
<span class="token assign-left variable">HOST</span><span class="token operator">=</span><span class="token number">192.168</span>.0.1
<span class="token assign-left variable">WAR</span><span class="token operator">=</span><span class="token variable">$WORKSPACE</span>/target/<span class="token variable">$PROJECT</span>-0.0.1-SNAPSHOT.war

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">$WAR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;待发布的 war 包不存在：filepath=<span class="token variable">$WAR</span>&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;...............path:<span class="token variable">$WAR</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;...............host:<span class="token variable">$HOST</span>&quot;</span>
<span class="token comment"># 3 scp war files</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;...............scp:<span class="token variable">$WAR</span> root@<span class="token variable">$HOST</span>:/tmp&quot;</span>
<span class="token function">scp</span> <span class="token variable">$WAR</span> root@<span class="token variable">$HOST</span>:/tmp
<span class="token builtin class-name">echo</span> <span class="token string">&quot;.................... scp war files: <span class="token variable">$WORKSPACE</span>/target/<span class="token variable">$PROJECT</span>-0.0.1-SNAPSHOT.war &quot;</span>

<span class="token comment"># 4.docker container restart</span>
<span class="token function">ssh</span> -tt root@<span class="token variable">$HOST</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
    docker container stop tomcattest

    rm -rf /home/docker/tomcat/webapps/<span class="token variable">$PROJECT</span>

    unzip /tmp/<span class="token variable">$PROJECT</span>-0.0.1-SNAPSHOT.war -d /home/docker/tomcat/webapps/<span class="token variable">$PROJECT</span>

    docker container start tomcattest

    exit
EOF</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;.................... docker container restart tomcattest &quot;</span>
</code></pre></div><ul><li><p>参考</p> <p><a href="https://blog.csdn.net/achenyuan/article/details/81166526" target="_blank" rel="noopener noreferrer">Widows 服务器里实现通过ssh工具SecureCRT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://www.uml.org.cn/pzgl/201808281.asp" target="_blank" rel="noopener noreferrer">实战：向GitHub提交代码时触发Jenkins自动构建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5b6329c2e51d4519044ab85f" target="_blank" rel="noopener noreferrer">在 ubuntu 中愉快的安装 Jenkins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://blog.csdn.net/boling_cavalry/article/details/78943061" target="_blank" rel="noopener noreferrer">实战：向GitHub提交代码时触发Jenkins自动构建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tools/jenkins/jenkins-gitlab-auto-devops.html" class="prev">
        Jenkins 配合Gitlab自动化构建项目
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0a9f859e.js" defer></script><script src="/assets/js/2.0a1de700.js" defer></script><script src="/assets/js/10.0b2efc69.js" defer></script>
  </body>
</html>
